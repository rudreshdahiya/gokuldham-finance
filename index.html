<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gokuldham Society Analysis</title>
    <!-- CRASH REPORTER (Must be first) -->
    <script src="crash_reporter.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>

<body>

    <!-- ==============================================
         SCREEN 1: ABDUL'S SHOP (SPLASH)
         ============================================== -->
    <!-- ==============================================
         Page 1: INTRO (Splash)
         ============================================== -->
    <div id="ui-page-1" class="ui-screen">
        <div class="splash-content">
            <h1 style="font-size: 5rem; margin-bottom: 0;">GOKULDHAM</h1>
            <div class="subtitle">TRUST BANK</div>
            <p style="font-size: 1.2rem; color: #ccc; margin: 20px 0;">"Sahi Investment, Sahi Future!"</p>

            <div class="mission-badge">
                Fair Price Discovery â€¢ Personalized Banking
            </div>

            <button id="btn-start" class="voxel-btn" onclick="goToPage(2)">
                <img src="assets/soda.png" alt="Soda">
                OPEN LEDGER
            </button>
        </div>
    </div>

    <!-- ==============================================
         Page 2: UPI RECEIPT (Inputs)
         ============================================== -->
    <div id="ui-page-2" class="ui-screen hidden">
        <div class="mobile-container receipt-paper">
            <div class="receipt-header">
                <h2>UPI TRANSFER RECEIPT</h2>
                <div class="receipt-meta">Transaction ID: GOKUL-8821</div>
            </div>

            <div class="input-section">
                <label>MONTHLY INCOME</label>
                <div class="currency-input">
                    <span>â‚¹</span>
                    <input type="number" id="input-income" placeholder="0" oninput="updateLedger()">
                </div>
            </div>

            <div class="sliders-section">
                <div class="slider-group">
                    <label>NEEDS (Rent, Food)</label>
                    <input type="range" id="slider-needs" value="50" min="0" max="100" oninput="updateLedger('needs')">
                    <span id="val-needs">50%</span>
                </div>
                <div class="slider-group">
                    <label>WANTS (Travel, Dining)</label>
                    <input type="range" id="slider-wants" value="30" min="0" max="100" oninput="updateLedger('wants')">
                    <span id="val-wants">30%</span>
                </div>
                <div class="slider-group">
                    <label>SAVINGS (Investments)</label>
                    <input type="range" id="slider-savings" value="20" min="0" max="100"
                        oninput="updateLedger('savings')">
                    <span id="val-savings">20%</span>
                </div>
            </div>

            <div class="total-check" id="total-check">Total: 100%</div>

            <button class="btn-primary" onclick="analyzeHabits()">
                SUBMIT TO LEDGER
            </button>
        </div>
    </div>

    <!-- ==============================================
         Page 3: CHARACTER REVEAL (Persona)
         ============================================== -->
    <div id="ui-page-3" class="ui-screen hidden">
        <div class="mobile-container persona-card">
            <div class="persona-header">YOU ARE...</div>
            <div id="persona-image-container">
                <!-- Injected via JS -->
            </div>
            <h1 id="persona-name">JETHALAL</h1>
            <p id="persona-desc">The Risk-Taker merchant who needs balance.</p>

            <div class="persona-stat">
                <span>Cluster ID:</span> <span id="persona-cluster">#A12</span>
            </div>

            <button class="btn-primary" onclick="goToPage(4)">
                BUILD MY PLAN
            </button>
            <button class="btn-text" onclick="goToPage(2)">
                Rewind Transaction
            </button>
        </div>
    </div>

    <!-- ==============================================
         Page 4: CONTEXT (Demographics)
         ============================================== -->
    <div id="ui-page-4" class="ui-screen hidden">
        <div class="mobile-container">
            <h2>COMPLETE KYC</h2>
            <p style="color:#aaa;">To calibrate inflation & risk.</p>

            <div class="form-group">
                <label>AGE</label>
                <select id="input-age">
                    <option value="18-22">18 - 22 (Student)</option>
                    <option value="22-28">22 - 28 (Young Pro)</option>
                    <option value="29-39" selected>29 - 39 (Mid Career)</option>
                    <option value="40-60">40 - 60 (Pre-Retire)</option>
                    <option value="60+">60+ (Retired)</option>
                </select>
            </div>

            <div class="form-group">
                <label>STATE (For Inflation Index)</label>
                <select id="input-state">
                    <!-- Populated via JS -->
                </select>
            </div>

            <div class="form-group">
                <label>PRIMARY GOALS (Select 2)</label>
                <div id="goal-pills-container" class="goal-pills-wrapper">
                    <!-- Populated via JS -->
                </div>
            </div>

            <button class="btn-primary" onclick="generateStrategy()">
                GENERATE MASTER PLAN
            </button>
        </div>
    </div>

    <!-- ==============================================
         Page 5: MASTER PLAN (Result)
         ============================================== -->
    <div id="ui-page-5" class="ui-screen hidden">
        <div class="mobile-container result-scroll">
            <div class="result-header">
                <h2>YOUR FINANCIAL PASSPORT</h2>
            </div>

            <!-- A. ASSET ALLOCATION -->
            <div class="card">
                <h3>Recommended Allocation</h3>
                <canvas id="allocationChart" style="max-height: 200px;"></canvas>
                <div id="allocation-details"></div>
            </div>

            <!-- B. TAX STRATEGY -->
            <div class="card">
                <h3>Tax Efficiency Strategy</h3>
                <div id="tax-strategy-content">
                    <div class="loading-text">Optimizing for 80C...</div>
                </div>
            </div>

            <!-- C. REBALANCING -->
            <div class="card">
                <h3>Rebalancing Schedule</h3>
                <div id="rebalancing-content"></div>
            </div>

            <div class="action-row">
                <button class="btn-secondary" onclick="window.location.reload()">DELETE DATA</button>
                <button class="btn-primary" onclick="goToPage(6)">TALK TO INSPECTOR</button>
            </div>
        </div>
    </div>

    <!-- ==============================================
         Page 6: AI COMPANION (Chat)
         ============================================== -->
    <div id="ui-page-6" class="ui-screen hidden">
        <div class="mobile-container chat-interface">
            <div class="chat-header">
                <div class="chat-avatar">ðŸ‘®</div>
                <div>
                    <div>Inspector Chalu Pandey</div>
                    <div style="font-size:0.7em; color:#ccc;">Gokuldham Police (Financial Crime Unit)</div>
                </div>
            </div>

            <div id="chat-history" class="chat-history">
                <div class="chat-msg system">
                    Namaste! I have reviewed your case file (Pages 1-5). Ask me anything about your logic or future.
                </div>
            </div>

            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Type your question...">
                <button onclick="sendMessage()">SEND</button>
            </div>

            <button class="btn-text" onclick="goToPage(5)">Back to Passport</button>
        </div>
    </div>

    <!-- END UI SCREENS -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <!-- SUPABASE SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- STACK AUTH SDK -->
    <script src="https://unpkg.com/@stackframe/js-core"></script>

    <!-- ANALYTICS: Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7GNSKT9D0R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-7GNSKT9D0R');
    </script>

    <!-- ANALYTICS: Microsoft Clarity -->
    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "v2i2peiyyt");
    </script>

    <!-- TELEMETRY: Sentry -->
    <script src="https://js.sentry-cdn.com/f6389a36d42bb1089afabd806967030f.min.js" crossorigin="anonymous"></script>
    <script>
        window.Sentry = window.Sentry || {};
        window.Sentry.onLoad = function () {
            Sentry.init({
                dsn: "https://f6389a36d42bb1089afabd806967030f@o4510686639161344.ingest.us.sentry.io/4510686684315648",
                integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
                tracesSampleRate: 1.0,
                replaysSessionSampleRate: 0.1,
                replaysOnErrorSampleRate: 1.0,
            });
        };
    </script>

    <script src="data_engine.js"></script>
    <script src="macro_data.js"></script>
    <script src="telemetry.js"></script>
    <script src="forensics_engine.js"></script>
    <script src="cloud_services.js"></script>
    <script src="script.js"></script>
</body>

</html>