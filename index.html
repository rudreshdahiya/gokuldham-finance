<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gokuldham Society Analysis</title>
    <!-- CRASH REPORTER (Must be first) -->
    <script src="crash_reporter.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>

<body>

    <!-- ==============================================
         SCREEN 1: SPLASH (THE HOOK)
         ============================================== -->
    <!-- ==============================================
         SCREEN 1: ABDUL'S SHOP (SPLASH)
         ============================================== -->
    <div id="ui-splash" class="ui-screen">
        <div class="splash-content">
            <h1 style="font-size: 6rem; margin-bottom: 0;">GOKULDHAM</h1>
            <div class="subtitle">TRUST BANK</div>
            <p style="font-size: 1.5rem; color: #ccc; margin: 20px 0;">"Sahi Investment, Sahi Future!"</p>

            <div style="margin: 30px 0;">
                <p>Welcome to <strong>Abdul's Soda Shop</strong>.</p>
                <p>Relax, have a soda, and let's check your finances.</p>
            </div>

            <button id="btn-splash-init" class="voxel-btn" onclick="goToInput()">
                <img src="assets/soda.png" alt="Soda">
                OPEN LEDGER
            </button>
        </div>
    </div>

    <!-- ==============================================
         SCREEN 2: DATA TERMINAL (THE INPUT)
         ============================================== -->
    <div id="ui-input" class="ui-screen hidden">
        <div class="terminal-window" id="input-terminal">
            <div class="terminal-header">
                <div class="buttons">
                    <div class="red"></div>
                    <div class="yellow"></div>
                    <div class="green"></div>
                </div>
                <button onclick="goBackToSplash()"
                    style="background:transparent; border:none; color:#aaa; font-size:1.5rem; cursor:pointer; margin-left:15px; padding:0;"
                    title="Back to Splash">
                    ⬅
                </button>
                <div class="header-logo">Gokuldham Bank</div>
                <div style="position:absolute; right:20px; top:20px;">
                    <button id="auth-btn"
                        style="background:#3498db; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer; font-family:'Courier New';">☁️
                        Sign In</button>
                </div>
            </div>
            <div class="terminal-body">
                <div class="console-log">
                    <span class="green">> SYSTEM:</span> Initializing Finance Engine...<br>
                    <span class="green">> STATE:</span> Waiting for user inputs...<br>
                    <span class="blue">> INFO:</span> Ideally, this data comes from your AA (Account Aggregator). For
                    now, tell us your estimates.<br><br>
                </div>

                <form id="finance-form">
                    <!-- 1. PERSONAL DETAILS -->
                    <div class="form-group-row">
                        <div class="form-group">
                            <label>AGE BRACKET</label>
                            <select id="input-age" onchange="updateGoals()">
                                <option value="18-22">18 - 22 (Student)</option>
                                <option value="22-28">22 - 28 (Young Pro)</option>
                                <option value="29-39" selected>29 - 39 (Mid Career)</option>
                                <option value="40-60">40 - 60 (Pre-Retire)</option>
                                <option value="60+">60+ (Retired)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>STATE (For Inflation Index)</label>
                            <select id="input-state">
                                <!-- Populated via JS -->
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>MONTHLY INCOME (₹)</label>
                        <input type="number" id="input-monthly-income" placeholder="e.g. 100000"
                            oninput="updateTotal()">
                    </div>

                    <div class="form-group">
                        <label>FINANCIAL GOALS (Select Multiple)</label>
                        <div id="goal-pills-container" class="goal-pills-wrapper">
                            <!-- Dynamic Content injected by JS -->
                        </div>
                        <div id="goal-primers" class="primer-text">Hover over a goal to see details.</div>
                    </div>

                    <div class="divider"></div>
                    <div class="section-title">MONTHLY SPEND BREAKDOWN (%)</div>
                    <div class="section-subtitle">Allocate your income in percentages. Total must be 100%.</div>

                    <div class="split-view">
                        <div class="left-inputs">
                            <!-- GPAY STYLE LEDGER -->
                            <div class="ledger-container" id="transaction-ledger">
                                <!-- Dynamic Expense Rows Injected Here -->
                                <div class="txn-placeholder">Loading your passbook...</div>
                            </div>
                        </div>

                        <div class="right-vis">
                            <div class="chart-container">
                                <canvas id="spendChart"></canvas>
                            </div>
                            <div class="total-status" id="total-display">TOTAL: 100%</div>
                            <button type="button" class="btn-process"
                                onclick="analyzeProfile()">RUN_DIAGNOSTIC_V10.1</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==============================================
         SCREEN 3: PROCESSING MATRIX (The Calculation)
         ============================================== -->
    <div id="ui-processing" class="ui-screen hidden">
        <div class="processing-terminal construction-zone">
            <div class="proc-header">
                <div>⚠️ SOCIETY MAINTENANCE IN PROGRESS ⚠️</div>
                <div class="voxel-loader"></div>
            </div>
            <div class="voxel-bar-container">
                <div class="voxel-bar-fill" id="proc-bar"></div>
            </div>
            <div class="proc-body" id="console-output" style="margin-top:20px;">
                <!-- Javascript injects logs here -->
            </div>
        </div>
    </div>

    <!-- ==============================================
         SCREEN 4: THE PASSPORT (The Result)
         ============================================== -->
    <div id="ui-result" class="ui-screen hidden">
        <!-- Content Injected via JS -->
    </div>

    <!-- END UI SCREENS -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- SUPABASE SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- STACK AUTH SDK (Using global bundle if available, otherwise we might need a workaround or simple fetch) -->
    <!-- Note: Stack Auth usually requires a bundler. For vanilla JS, we might fallback to basic fetch or assume simple layout -->
    <script src="https://unpkg.com/@stackframe/js-core"></script>

    <!-- ANALYTICS: Google Analytics -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7GNSKT9D0R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-7GNSKT9D0R');
    </script>


    <!-- SUPABASE SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- ANALYTICS: Microsoft Clarity -->
    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "v2i2peiyyt");
    </script>

    <!-- TELEMETRY: Sentry -->
    <script src="https://js.sentry-cdn.com/f6389a36d42bb1089afabd806967030f.min.js" crossorigin="anonymous"></script>
    <script>
        window.Sentry = window.Sentry || {};
        window.Sentry.onLoad = function () {
            Sentry.init({
                dsn: "https://f6389a36d42bb1089afabd806967030f@o4510686639161344.ingest.us.sentry.io/4510686684315648",
                integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
                tracesSampleRate: 1.0,
                replaysSessionSampleRate: 0.1,
                replaysOnErrorSampleRate: 1.0,
            });
        };
    </script>
    <script src="crash_reporter.js"></script>
    <script src="data_engine.js"></script>
    <script src="macro_data.js"></script>
    <script src="telemetry.js"></script>
    <script src="forensics_engine.js"></script>
    <script src="cloud_services.js"></script>
    <script src="script.js"></script>
</body>

</html>